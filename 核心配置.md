# 核心配置

## 简介

`DataFaker` 支持通过配置来改变数据生成的行为，比如设置语言环境、设置生成数据量、设置后处理器、设置递归深度等。

## 多种配置方式

总的来说`DataFaker` 支持多种配置方式，主要有三种：

1. 全局配置
2. 模板中静态配置
3. 运行时配置

## 全局设置语言环境

### 什么是语言环境

语言环境是指`DataFaker`使用的语言，比如中文、英文、德文等。`DataFaker`支持语言环境的设置，这样生成的数据就带有相应的语言风格。

### 基本语法

可以通过`DataFaker.setLocale()`方法全局设置默认语言环境。这个方法会接受一个参数，参数类型如下所示：
::: code-group

```ts [单语言环境]
// 以字符串的方式设置语言环境为中文
DataFaker.setLocale('zh_CN');
// 或者直接使用中文faker对象来进行设置,allFakers是所有faker对象集合
DataFaker.setLocale(allFakers['zh_CN']);
```

```ts [多语言环境]
// 优先中文然后如果中文对应数据不存在则采用英文，最后采用德文
DataFaker.setLocale(['zh_CN', 'en_US', de_CH]);
```

```ts [自定义faker对象]
// 或你可以自定义faker对象
const customLocale: LocaleDefinition = {
  internet: {
    domainSuffix: ['test'],
  },
};
const customFaker = new Faker({
  locale: [customLocale, de_CH, de, en, base],
});
DataFaker.setLocale(customFaker);
```

:::

::: tip 语言缓存
实际上`DataFaker.setLocale(['zh_CN', 'en_US', de_CH])`等价于

```ts
const customFaker = new Faker({
  locale: [zh_CN, en_US, de_CH],
});
DataFaker.setLocale(customFaker);
```

它会创建出一个新的`Faker`对象，并缓存起来，下次再调用`DataFaker.setLocale(['zh_CN', 'en_US', de_CH])`时，会直接使用缓存的对象。

:::

### 使用示例

> 案例：比如下用户模型和公司模型，我们可以采用中文语言环境为默认环境，这时候生成的数据当中就含有中文：

::: code-group

```ts {11-12} [代码]
// 用户模型
const userModel = defineModel('user', {
  id: 'number.int',
  firstName: 'person.firstName',
  secondName: 'person.lastName',
  age: ['number.int', { min: 18, max: 65 }],
  email: (ctx) => {
    return faker.internet.email({ firstName: ctx.firstName, lastName: ctx.secondeName });
  },
});
// 设置全局语言环境为中文
DataFaker.setLocale('zh_CN');
const userDatas = fakeData(userModel);
console.dir(userDatas, { depth: Infinity });
// 公司模型
const companyModel = defineModel('company', {
  name: 'company.name',
  address: 'location.streetAddress',
});
const companyDatas = fakeData(companyModel);
console.dir(companyDatas, { depth: Infinity });
```

```json [结果]
// 用户数据
{
  "id": 1040719705843601,
  "firstName": "鹭洋",
  "secondName": "薛",
  "age": 58,
  "email": "valljf_Larkin29@hotmail.com"
}
// 公司数据
{
  "name": "辽宁省榕融传媒无限公司",
  "address": "英巷28404号"
}
```

:::

## 全局设置后处理器

### 什么是后处理器

后处理器是对生成的数据进行二次加工的函数或函数队列，`DataFaker`支持全局设置，这样所有数据在生成之前都会经过后处理器进行处理后再生成。

### 基本语法

后处理器可以是一个函数也可以是一个函数数组，数组中的函数会按顺序执行，并且函数可以接受一个参数，这个参数是生成后的或前一个处理器处理后的数据。全局设置后处理器的方式如下所示：
::: code-group

```ts [设置单个后处理器]
DataFaker.setCallbacks((data) => {
  data['id'] = faker.string.uuid();
  return data;
});
```

```ts [设置多个后处理器]
DataFaker.setCallbacks([
  (data) => {
    data['id'] = faker.string.uuid();
    return data;
  },
  (data) => {
    data['created_at'] = new Date().toISOString();
    return data;
  },
]);
```

:::

### 使用示例

> 案例：比如我希望为所有生成的数据加上`id`，那么我可以配置全局后处理器，这样所有模型在生成数据时都会自动加上`id`属性了。如下所示：

::: code-group

```ts {1-4}[代码]
DataFaker.setCallbacks((data) => {
  data['id'] = faker.string.uuid();
  return data;
});
// 用户模型
const userModel = defineModel('user', {
  firstName: 'person.firstName',
  secondName: 'person.lastName',
  age: ['number.int', { min: 18, max: 65 }],
  email: (ctx) => {
    return faker.internet.email({ firstName: ctx.firstName, lastName: ctx.secondeName });
  },
});
DataFaker.setLocale('zh_CN');
const userDatas = fakeData(userModel);
console.dir(userDatas, { depth: Infinity });
// 公司模型
const companyModel = defineModel('company', {
  name: 'company.name',
  address: 'location.streetAddress',
});
const companyDatas = fakeData(companyModel);
console.dir(companyDatas, { depth: Infinity });
```

```json {7,12} [结果]
// 生成的数据如下,可见数据中都包含 id 属性：
{
  "firstName": "晓啸",
  "secondName": "靳",
  "age": 62,
  "email": "k7ngvs.Heidenreich92@yahoo.com",
  "id": "c39be576-95fa-4e77-92ed-c621640f3695"
}
{
  "name": "贵阳市琪印刷有限公司",
  "address": "旷街6号",
  "id": "0b80ab0f-ba3f-4215-ac56-95c8a8940bdb"
}
```

:::

## 运行时配置

### 什么是运行时配置

运行时配置是指在生成数据时再指定的配置，也就是`fakeData`方法的第二个参数`options`，如下所示：
::: code-group

```ts [引用模块配置规则]
/**
 * Fake数据规则
 */
type RefModelRule = {
  /**
   * 生成数量
   */
  [COUNT]?: number;
  /**
   * 引用自身时的递归深度
   */
  [DEEP]?: number;
  /**
   * 结构递归
   */
  [key: string | symbol]: number | RefModelRule | [number, number];
};
```

```ts [后处理器配置规则]
type DataFakeCb = ((data: any) => any) | Array<(data: any) => any>;
```

```ts [语言环境配置规则]
/**
 * 语言环境类型
 */
type LocaleType = AllFakers | Array<LocaleDefinition | AllFakers> | Faker;
```

```ts [options]
/**
 * 使用模型配置
 */
type DataFakeOptions = {
  /**
   * 生成数量
   */
  count?: number;
  /**
   * 对于引用类型的规则
   */
  refRules?: RefModelRule;
  /**
   * 回调函数
   * @description 对生成的数据进行后处理
   */
  callbacks?: DataFakeCb;
  /**
   * 语言环境
   */
  locale?: LocaleType;
};
```

:::

也就是说可以在生成数据的时候，指定

1. 本身数据的生成数量
2. 引用数据的生成数量
3. 自引用数据的生成数量和递归深度
4. 后处理回调
5. 语言环境

### 配置优先级

其优先级为：

1. 运行时配置 `>` 模板中静态配置
2. 运行时配置 `>` 全局配置

### 运行时配置

运行时后处理器可以是一个函数也可以是一个数组，数组中的函数会按顺序执行,并且函数可以接受一个参数，这个参数是生成后的或前一个处理器处理后的数据。

`DataFaker`支持运行时设置语言环境，可以通过`fakeData`方法的第二个参数`options`来设置：
